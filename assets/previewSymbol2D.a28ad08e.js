import{iS as M,y as g,iT as E,iU as q,iV as O,f as P,iW as L,iX as U,be as S,iY as C,iZ as V,ba as W}from"./index.a2b594ae.js";const T="picture-fill",A="picture-marker",B="simple-fill",R="simple-line",H="simple-marker",X="text",Y="Aa",G=M.size,k=M.maxSize,j=M.maxOutlineSize,I=M.lineWidth,F=225,J=document.createElement("canvas");function K(a,e){const n=J.getContext("2d"),i=[];return e&&(e.weight&&i.push(e.weight),e.size&&i.push(e.size+"px"),e.family&&i.push(e.family)),n.font=i.join(" "),n.measureText(a).width}const N=7.2/2.54,Q=72/2.54;function _(a){if(a.length===0)return 0;if(a.length>2){const e=W(1),n=parseFloat(a);switch(a.slice(-2)){case"px":return n;case"pt":return n*e;case"in":return 72*n*e;case"pc":return 12*n*e;case"mm":return n*N*e;case"cm":return n*Q*e}}return parseFloat(a)}function Z(a){const e=a==null?void 0:a.size;return{width:e!=null&&typeof e=="object"&&"width"in e?g(e.width):null,height:e!=null&&typeof e=="object"&&"height"in e?g(e.height):null}}async function $(a,e){const n=e.fill,i=a.color;if((n==null?void 0:n.type)==="pattern"&&i&&a.type!==T){const u=await V(n.src,i.toCss(!0));n.src=u,e.fill=n}}function D(a,e){return a>e?"dark":"light"}function ee(a,e){var z;const n=typeof(e==null?void 0:e.size)=="number"?e==null?void 0:e.size:null,i=n!=null?g(n):null,u=(e==null?void 0:e.maxSize)!=null?g(e.maxSize):null,h=(e==null?void 0:e.rotation)!=null?e.rotation:"angle"in a?a.angle:null,f=E(a);let m=q(a);ae(a,245)!=="dark"||(e==null?void 0:e.ignoreWhiteSymbols)||(m={width:.75,...m,color:"#bdc3c7"});const r={shape:null,fill:f,stroke:m,offset:[0,0]};m!=null&&m.width&&(m.width=Math.min(m.width,j));const p=(m==null?void 0:m.width)||0;let y=(e==null?void 0:e.size)!=null&&((e==null?void 0:e.scale)==null||(e==null?void 0:e.scale)),s=0,l=0,v=!1;switch(a.type){case H:{const o=a.style,c=Math.min(i!=null?i:g(a.size),u||k);switch(s=c,l=c,o){case"circle":r.shape={type:"circle",cx:0,cy:0,r:.5*c},y||(s+=p,l+=p);break;case"cross":r.shape={type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[s,.5*l]},{command:"M",values:[.5*s,0]},{command:"L",values:[.5*s,l]}]};break;case"diamond":r.shape={type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[.5*s,0]},{command:"L",values:[s,.5*l]},{command:"L",values:[.5*s,l]},{command:"Z",values:[]}]},y||(s+=p,l+=p);break;case"square":r.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[s,0]},{command:"L",values:[s,l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]},y||(s+=p,l+=p),h&&(v=!0);break;case"triangle":r.shape={type:"path",path:[{command:"M",values:[.5*s,0]},{command:"L",values:[s,l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]},y||(s+=p,l+=p),h&&(v=!0);break;case"x":r.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[s,l]},{command:"M",values:[s,0]},{command:"L",values:[0,l]}]},h&&(v=!0);break;case"path":r.shape={type:"path",path:a.path||""},y||(s+=p,l+=p),h&&(v=!0),y=!0}break}case R:{const{width:o,height:c}=Z(e),t=c!=null?c:Math.min(i!=null?i:p,u||j),d=o!=null?o:I;m.width=t,s=d,l=t;const w=((z=r==null?void 0:r.stroke)==null?void 0:z.cap)||"butt",b=w==="round";y=!0,r.stroke.cap=w==="butt"?"square":w,r.shape={type:"path",path:[{command:"M",values:[b?t/2:0,l/2]},{command:"L",values:[b?s-t/2:s,l/2]}]};break}case T:case B:{const o=typeof(e==null?void 0:e.symbolConfig)=="object"&&(e==null?void 0:e.symbolConfig.isSquareFill),{width:c,height:t}=Z(e);s=o&&c!=null?c:i!=null?i:G,l=o&&t!=null?t:s,y||(s+=p,l+=p),y=!0,r.shape=o?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[s,0]},{command:"L",values:[s,l]},{command:"L",values:[0,l]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:O.fill[0];break}case A:{let o=g(a.width),c=g(a.height);const t=i!=null?i:Math.max(o,c),d=o/c;o=d<=1?Math.ceil(t*d):t,c=d<=1?t:Math.ceil(t/d),s=Math.min(o,u||k),l=Math.min(c,u||k),r.shape={type:"image",x:-Math.round(s/2),y:-Math.round(l/2),width:s,height:l,src:a.url||""},h&&(v=!0);break}case X:{const o=a,c=o.text||Y,t=o.font,d=Math.min(i!=null?i:g(t.size),u||k),w=K(c,{weight:t.weight,size:d,family:t.family}),b=/[\uE600-\uE6FF]/.test(c);s=b?d:w,l=d;let x=.25*_((t?d:0).toString());b&&(x+=5),r.shape={type:"text",text:c,x:o.xoffset||0,y:o.yoffset||x,align:"middle",alignBaseline:o.verticalAlignment,decoration:t&&t.decoration,rotated:o.rotated,kerning:o.kerning},r.font=t&&{size:d,style:t.style,decoration:t.decoration,weight:t.weight,family:t.family};break}}return{shapeDescriptor:r,size:[s,l],renderOptions:{node:e==null?void 0:e.node,scale:y,opacity:e==null?void 0:e.opacity,rotation:h,useRotationSize:v,effectView:e==null?void 0:e.effectView}}}async function se(a,e){const{shapeDescriptor:n,size:i,renderOptions:u}=ee(a,e);if(!n.shape)throw new P("symbolPreview: renderPreviewHTML2D","symbol not supported.");await $(a,n);const h=[[n]];if(typeof(e==null?void 0:e.symbolConfig)=="object"&&(e==null?void 0:e.symbolConfig.applyColorModulation)){const f=.6*i[0];h.unshift([{...n,offset:[-f,0],fill:L(n.fill,-.3)}]),h.push([{...n,offset:[f,0],fill:L(n.fill,.3)}]),i[0]+=2*f,u.scale=!1}return U(h,i,u)}function ae(a,e=F){const n=E(a),i=q(a),u=!n||"type"in n?null:new S(n),h=i!=null&&i.color?new S(i==null?void 0:i.color):null,f=u?D(C(u),e):null,m=h?D(C(h),e):null;return m?f?f===m?f:e>=F?"light":"dark":m:f}export{ae as getContrastingBackgroundTheme,ee as getRenderSymbolParameters,se as previewSymbol2D};
